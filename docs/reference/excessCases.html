<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fits a baseline to case data — excessCases • ExcessILI</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fits a baseline to case data — excessCases" />
<meta property="og:description" content="excessCases takes a time series of cases (daily or weekly) and fits a
  harmonic baseline. There is also an option to import influenza data from
  the CDC's NREVSS database and match it by state, or import Google search
  queries for RSV for the respective state. Dummy variables adjust for
  variations in average incidence between years, and interactions between
  RSV or flu allow these effects to vary over time." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ExcessILI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ESSENCE.html">Going from line list data to an interactive app</a>
    </li>
    <li>
      <a href="../articles/ILINet.html">Using ExcessILI with ILINet</a>
    </li>
    <li>
      <a href="../articles/PImortality.html">Using ExcessILI with US P&amp;I mortality data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fits a baseline to case data</h1>
    
    <div class="hidden name"><code>excessCases.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>excessCases</code> takes a time series of cases (daily or weekly) and fits a
  harmonic baseline. There is also an option to import influenza data from
  the CDC's NREVSS database and match it by state, or import Google search
  queries for RSV for the respective state. Dummy variables adjust for
  variations in average incidence between years, and interactions between
  RSV or flu allow these effects to vary over time.</p>
    </div>

    <pre class="usage"><span class='fu'>excessCases</span>(
  <span class='no'>ds</span>,
  <span class='kw'>sub.statevar</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='kw'>statevar</span> <span class='kw'>=</span> <span class='st'>"state"</span>,
  <span class='kw'>agevar</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='no'>datevar</span>,
  <span class='no'>use.syndromes</span>,
  <span class='no'>denom.var</span>,
  <span class='kw'>adj.flu</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='kw'>adj.rsv</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
  <span class='kw'>time.res</span> <span class='kw'>=</span> <span class='st'>"day"</span>,
  <span class='kw'>extrapolation.date</span> <span class='kw'>=</span> <span class='st'>"2020-03-01"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ds</th>
      <td><p>A dataframe, with a format similar to the one produced by the
<code><a href='ts_format.html'>ts_format</a></code> function. There should be a row for each time
period (week or day), location (e.g. state, county), and age category.
There must be a column for date (<code>YYYY-MM-DD</code>), age category,
location, and the number of counts for each of the selected syndromes.
There should also be a column with a denominator (e.g., total number of ED
visits). If there is no denominator, create a variable with vector of 1s
as a substitute.</p></td>
    </tr>
    <tr>
      <th>sub.statevar</th>
      <td><p>A string. Which variable in the input data frame
contains the local geography identifier (e.g., county, borough)</p></td>
    </tr>
    <tr>
      <th>statevar</th>
      <td><p>A string. Which variable in the input data frame contains
the state (2-digit state; e.g. <code>'NY'</code>)?</p></td>
    </tr>
    <tr>
      <th>agevar</th>
      <td><p>A string. Which variable in the input data frame contains the
age group? Use <code>'none'</code> if there is no age grouping in the data</p></td>
    </tr>
    <tr>
      <th>datevar</th>
      <td><p>A string. Which variable in the input data frame contains
the date?</p></td>
    </tr>
    <tr>
      <th>use.syndromes</th>
      <td><p>A vector with the variable names for syndromes to be
tested (e.g., <code><a href='https://rdrr.io/r/base/c.html'>c('ILI','respiratory')</a></code> ).</p></td>
    </tr>
    <tr>
      <th>denom.var</th>
      <td><p>A string. Which variable on the input dataframe should be
used as the denominator? For instance, all ED visits.</p></td>
    </tr>
    <tr>
      <th>adj.flu</th>
      <td><p>A logical scalar. How should influenza be adjusted for when
fitting the seasonal baseline? Possible values are <code>'none'</code> for no
adjustment (default); 'auto': automatically downloads NREVSS data from CDC
and matches by state and week; or specify the name of a variable in the
the input dataframe that contains a variable for influenza. <strong>The
package <code>cdcfluview</code> is required to use <code>'auto'</code>.</strong></p></td>
    </tr>
    <tr>
      <th>adj.rsv</th>
      <td><p>A string. How should RSV be adjusted for when fitting the
seasonal baseline? Possible values are <code>'none'</code> for no adjustment
(default); <code>'auto'</code>: automatically downloads the weekly volume of
search queries for 'RSV' for the last 5 years from Google trends and
matches by state. Note that a maximum of 5 states can be included on the
input dataset when using the 'auto option'; Or specify the name of a
variable in the the input dataframe that contains a variable for
influenza.</p></td>
    </tr>
    <tr>
      <th>time.res</th>
      <td><p>One of <code><a href='https://rdrr.io/r/base/c.html'>c("day", "week", "month")</a></code>. What is the data
binned by?</p></td>
    </tr>
    <tr>
      <th>extrapolation.date</th>
      <td><p>The model is fit up to this date, and then
extrapolated for all future dates. Defaults to <code>"2020-03-01"</code></p></td>
    </tr>
    <tr>
      <th>flu.import</th>
      <td><p>A logical scalar. Import the latest influenza testing data
from the CDC NREVSS system? If TRUE, the data will be downloaded and merge
with the input dataframe by state and week. the flu variable will be
included in the regressionwhen fitting the baseline</p></td>
    </tr>
    <tr>
      <th>rsv.import</th>
      <td><p>A logical scalar. Import weekly search volume for 'RSV'
for the states in the input dataframe? This option can only be used if
there are 5 or fewer states on the input dataset. This variable is
included in the regression model when fitting the seasonal baseline.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of lists with an entry for each syndrome, and sub-lists by
  age group and geography:</p>
<p><code>date</code>: vector of dates used in the model. Use the helper function
  <code><a href='excessExtract.html'>excessExtract</a></code> to pull out specific components and organize
  them into an array</p>
<p><code>y</code>: array of observed values for the syndromes</p>
<p><code>resid1</code>: Observed/model fitted values</p>
<p><code>upi</code>: upper 95<!-- % prediction interval of the fitted value --></p>
<p><code>lpi</code>: lower 95<!-- % prediction interval of the fitted value --></p>
<p><code>sqrt.rsv</code>: RSV variale used in the model (if any)</p>
<p><code>log.flu</code>: flu variable used in the model (if any)</p>
<p><code>unexplained.cases</code>: observed-expected(fitted)</p>
<p><code>denom</code>: denominator used in the model</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'> <span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>cdcfluview</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: package 'cdcfluview' was built under R version 3.6.3</span></div><div class='input'> <span class='no'>ili.data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/cdcfluview/man/ilinet.html'>ilinet</a></span>(<span class='kw'>region</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"state"</span>))
 <span class='no'>ili.data</span>$<span class='no'>state</span> <span class='kw'>&lt;-</span> <span class='no'>state.abb</span>[<span class='fu'><a href='https://rdrr.io/r/base/match.html'>match</a></span>(<span class='no'>ili.data</span>$<span class='no'>region</span>, <span class='no'>state.name</span>)]

 <span class='no'>ili.data</span> <span class='kw'>&lt;-</span> <span class='no'>ili.data</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"state"</span>, <span class='st'>"week_start"</span>, <span class='st'>"ilitotal"</span>, <span class='st'>"total_patients"</span>)]
 <span class='no'>ili.data</span> <span class='kw'>&lt;-</span> <span class='no'>ili.data</span>[<span class='no'>ili.data</span>$<span class='no'>state</span> <span class='kw'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"CA"</span>, <span class='st'>"NY"</span>, <span class='st'>"WA"</span>, <span class='st'>"NJ"</span>, <span class='st'>"CT"</span>), ]

 <span class='no'>excess_cases</span> <span class='kw'>&lt;-</span>
   <span class='fu'>excessCases</span>(<span class='kw'>ds</span> <span class='kw'>=</span> <span class='no'>ili.data</span>,
               <span class='kw'>datevar</span> <span class='kw'>=</span> <span class='st'>"week_start"</span>,
               <span class='kw'>agevar</span> <span class='kw'>=</span> <span class='st'>"none"</span>,
               <span class='kw'>statevar</span> <span class='kw'>=</span> <span class='st'>"state"</span>,
               <span class='kw'>denom.var</span> <span class='kw'>=</span> <span class='st'>"total_patients"</span>,
               <span class='kw'>use.syndromes</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"ilitotal"</span>),
               <span class='kw'>time.res</span> <span class='kw'>=</span> <span class='st'>"week"</span>)</div><div class='output co'>#&gt; [1] "epiyr.index.f + sin1 + cos1 + sin2 + cos2 + sin3 + cos3"
#&gt; [1] "epiyr.index.f + sin1 + cos1 + sin2 + cos2 + sin3 + cos3"
#&gt; [1] "epiyr.index.f + sin1 + cos1 + sin2 + cos2 + sin3 + cos3"
#&gt; [1] "epiyr.index.f + sin1 + cos1 + sin2 + cos2 + sin3 + cos3"
#&gt; [1] "epiyr.index.f + sin1 + cos1 + sin2 + cos2 + sin3 + cos3"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Daniel Weinberger, Marcus Russi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


